<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocabulary Card V5 - Fixed</title>
    <style>
        /* ============================================
           é¢œè‰²é…ç½®åŒºåŸŸ - åœ¨è¿™é‡Œè‡ªç”±è®¾ç½®é¢œè‰²
           ============================================ */
        :root {
            /* å•è¯é¢œè‰²ï¼ˆå¯ä»¥ä¿®æ”¹ä¸ºä»»ä½•é¢œè‰²ï¼‰ */
            --word-color: #6c757d;
        }
        /* ============================================ */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, "PingFang SC", -apple-system, BlinkMacSystemFont, serif;
            background: white;
            padding: 0;
            margin: 0;
        }
        
        /* ä¸­æ–‡å­—ä½“ */
        .chinese {
            font-family: "PingFang SC", -apple-system, BlinkMacSystemFont, "Microsoft YaHei", sans-serif;
        }
        
        /* è‹±æ–‡å­—ä½“ */
        .english {
            font-family: Georgia, serif;
        }
        
        /* å¡ç‰‡å®¹å™¨ */
        .card {
            background: white;
            width: 100%;
            max-width: 100%;
            padding: 40px 50px;
        }
        
        /* æ ‡é¢˜è¡Œï¼ˆå•è¯+éŸ³æ ‡+æŒ‰é’®ï¼‰ */
        .title-row {
            display: flex;
            align-items: baseline;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* å•è¯æ ‡é¢˜ */
        .word-title {
            font-size: 52px;
            font-weight: normal;
            color: var(--word-color);
            font-family: Georgia, serif;
        }
        
        /* éŸ³æ ‡ */
        .phonetic {
            font-size: 24px;
            color: var(--word-color);
            font-family: "Lucida Sans Unicode", "DejaVu Sans", "Arial Unicode MS", sans-serif;
        }
        
        /* æŒ‰é’®å®¹å™¨ */
        .buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* å›¾æ ‡æŒ‰é’® */
        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 24px;
            color: #6c757d;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }
        
        .icon-btn:hover {
            color: #495057;
        }
        
        .favorite-btn.active {
            color: #e74c3c;
        }
        
        /* ä¸­æ–‡é‡Šä¹‰ */
        .translation-text {
            font-size: 20px;
            line-height: 1.8;
            color: #212529;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* åˆ†ç»„ */
        .section {
            margin-bottom: 25px;
        }
        
        /* åˆ†ç»„æ ‡é¢˜ */
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #212529;
            font-family: "PingFang SC", sans-serif;
            display: inline;
            margin-right: 10px;
        }
        
        /* å†…å®¹ */
        .section-content {
            display: inline;
            font-size: 20px;
            line-height: 1.8;
            color: #212529;
            font-family: Georgia, serif;
        }
        
        /* ä¾‹å¥åŒºåŸŸï¼ˆå¯æŠ˜å ï¼‰ */
        .example-header {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .example-cn {
            font-size: 20px;
            line-height: 1.8;
            color: #212529;
            font-family: "PingFang SC", sans-serif;
            flex: 1;
        }
        
        .expand-btn {
            font-size: 18px;
            color: #6c757d;
            transition: transform 0.3s;
        }
        
        .expand-btn.expanded {
            transform: rotate(180deg);
        }
        
        .example-content {
            display: none;
            background: #f8f9fa;
            padding: 20px 25px;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .example-content.show {
            display: block;
        }
        
        .example-en {
            font-size: 20px;
            line-height: 1.8;
            color: #495057;
            font-family: Georgia, serif;
            font-style: italic;
        }
        
        /* åŒä¹‰è¡¨è¾¾å®¹å™¨ */
        .expressions-container {
            display: inline-flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        
        .expression-tag {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            color: #495057;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 18px;
            font-family: Georgia, serif;
        }
        
        /* ç›¸å…³è¡¨è¾¾é¡¹ */
        .related-item {
            margin-top: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .related-header {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .related-phrase {
            font-size: 20px;
            font-weight: 600;
            color: #212529;
            font-family: Georgia, serif;
        }
        
        .related-translation {
            font-size: 18px;
            color: #6c757d;
            font-family: "PingFang SC", sans-serif;
        }
        
        .related-example {
            font-size: 18px;
            font-style: italic;
            color: #495057;
            font-family: Georgia, serif;
            margin-bottom: 8px;
        }
        
        .related-example-cn {
            font-size: 18px;
            color: #6c757d;
            font-family: "PingFang SC", sans-serif;
            margin-bottom: 12px;
        }
        
        .related-note {
            font-size: 17px;
            color: #6c757d;
            font-family: "PingFang SC", sans-serif;
            padding-left: 15px;
            border-left: 3px solid #dee2e6;
        }
        
        /* åŸæ–‡ä¾‹å¥éƒ¨åˆ†ï¼ˆå¯æŠ˜å +ç‹¬ç«‹æ»šåŠ¨ï¼‰ */
        .original-examples {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }
        
        .original-header-row {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .original-header-row:hover .original-expand-btn {
            color: #495057;
        }
        
        .original-header-title {
            font-size: 20px;
            font-weight: 600;
            color: #212529;
            font-family: "PingFang SC", sans-serif;
        }
        
        /* ç»Ÿè®¡æ ‡ç­¾ */
        .stats-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 16px;
            background: white;
            border: 1.5px solid #dee2e6;
            border-radius: 20px;
            font-size: 16px;
            color: #6c757d;
            font-family: "PingFang SC", sans-serif;
        }
        
        .stats-divider {
            color: #dee2e6;
        }
        
        .original-expand-btn {
            font-size: 18px;
            color: #6c757d;
            transition: transform 0.3s, color 0.2s;
            margin-left: auto;
        }
        
        .original-expand-btn.expanded {
            transform: rotate(180deg);
        }
        
        /* åŸæ–‡å†…å®¹åŒºåŸŸï¼ˆç‹¬ç«‹æ»šåŠ¨ï¼‰ */
        .original-content {
            display: none;
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 10px;
        }
        
        .original-content.show {
            display: block;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .original-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .original-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .original-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .original-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .original-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        /* æœŸæ•°æ ‡ç­¾ */
        .episode-tag {
            display: inline-block;
            background: white;
            border: 1.5px solid #dee2e6;
            color: #6c757d;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .original-en {
            font-size: 19px;
            line-height: 1.8;
            color: #212529;
            font-family: Georgia, serif;
            margin-bottom: 10px;
        }
        
        .original-cn {
            font-size: 19px;
            line-height: 1.8;
            color: #6c757d;
            font-family: "PingFang SC", sans-serif;
            margin-bottom: 15px;
        }
        
        /* é«˜äº®å•è¯/çŸ­è¯­ */
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* éŸ³é¢‘æ§åˆ¶æŒ‰é’® */
        .audio-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .audio-btn {
            width: 36px;
            height: 36px;
            background: white;
            border: 1.5px solid #dee2e6;
            border-radius: 8px;
            font-size: 18px;
            color: #6c757d;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
        }
        
        .audio-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
            color: #495057;
        }
        
        .audio-btn.active {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        /* é€Ÿåº¦è¾“å…¥æ¡† */
        .speed-input {
            min-width: 50px;
            padding: 6px 12px;
            border: 1.5px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            color: #6c757d;
            background: white;
            cursor: pointer;
            text-align: center;
            font-family: -apple-system, sans-serif;
            transition: all 0.2s;
            outline: none;
        }
        
        .speed-input:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        
        .speed-input[contenteditable="true"] {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
            cursor: text;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .card {
                padding: 30px 25px;
            }
            
            .title-row {
                flex-wrap: wrap;
            }
            
            .word-title {
                font-size: 40px;
            }
            
            .original-content {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <!-- æ ‡é¢˜è¡Œï¼šå•è¯ + éŸ³æ ‡ + å‘éŸ³ + æ”¶è— -->
        <div class="title-row">
            <h1 class="word-title english" id="wordTitle">schedule</h1>
            <span class="phonetic" id="wordPhonetic">/ËˆskÉ›dÊ’uËl/</span>
            <div class="buttons">
                <button class="icon-btn sound-btn" onclick="playSound('schedule')" title="å‘éŸ³">ğŸ”Š</button>
                <button class="icon-btn favorite-btn" onclick="toggleFavorite(this)" title="æ”¶è—">â™¡</button>
            </div>
        </div>
        
        <!-- ä¸­æ–‡é‡Šä¹‰ -->
        <p class="translation-text chinese" id="wordTranslation">æ—¶é—´è¡¨ï¼›è®¡åˆ’è¡¨ï¼›æ—¥ç¨‹è¡¨</p>
        
        <!-- è‹±è‹±é‡Šä¹‰ -->
        <div class="section">
            <h2 class="section-title chinese">è‹±è‹±é‡Šä¹‰ï¼š</h2>
            <span class="section-content english">A timetable that organizes events according to a set time frame.</span>
        </div>
        
        <!-- ä¾‹å¥ï¼ˆå¯æŠ˜å ï¼‰ -->
        <div class="section">
            <div class="example-header" onclick="toggleExample(this)">
                <h2 class="section-title chinese">ä¾‹å¥ï¼š</h2>
                <span class="example-cn chinese">æˆ‘ä»¬å¯ä»¥å®‰æ’æ˜å¤©å¼€ä¼šå—ï¼Ÿ</span>
                <span class="expand-btn">â–¼</span>
            </div>
            <div class="example-content">
                <p class="example-en english">Can we schedule a meeting for tomorrow?</p>
            </div>
        </div>
        
        <!-- åŒä¹‰è¡¨è¾¾ -->
        <div class="section">
            <h2 class="section-title chinese">åŒä¹‰è¡¨è¾¾ï¼š</h2>
            <div class="expressions-container">
                <span class="expression-tag english">timetable</span>
                <span class="expression-tag english">fortune</span>
                <span class="expression-tag english">happy accident</span>
            </div>
        </div>
        
        <!-- ç›¸å…³è¡¨è¾¾ -->
        <div class="section">
            <h2 class="section-title chinese">ç›¸å…³è¡¨è¾¾ï¼š</h2>
            
            <div class="related-item">
                <div class="related-header">
                    <span class="related-phrase english">on schedule</span>
                    <span class="related-translation chinese">æŒ‰è®¡åˆ’è¿›è¡Œæˆ–å‡†æ—¶</span>
                </div>
                <div class="related-example english">The construction is on schedule and should be completed by next month.</div>
                <div class="related-example-cn chinese">å»ºç­‘å·¥ç¨‹æŒ‰è®¡åˆ’è¿›è¡Œï¼Œåº”è¯¥åœ¨ä¸‹ä¸ªæœˆå®Œæˆã€‚</div>
                <div class="related-note chinese">ğŸ’¡ å¼ºè°ƒäº‹æƒ…å‘ç”Ÿçš„å¶ç„¶æ€§ï¼Œå¸¸ç”¨äºæè¿°æ„å¤–çš„ç›¸é‡æˆ–å‘ç°ã€‚</div>
            </div>
            
            <div class="related-item">
                <div class="related-header">
                    <span class="related-phrase english">stroke of luck</span>
                    <span class="related-translation chinese">ä¸€æ¬¡å¥½è¿ï¼›å¹¸è¿çš„äº‹</span>
                </div>
                <div class="related-example english">Finding that job was a real stroke of luck.</div>
                <div class="related-example-cn chinese">æ‰¾åˆ°é‚£ä»½å·¥ä½œçœŸæ˜¯ä¸€æ¬¡å¥½è¿ã€‚</div>
                <div class="related-note chinese">ğŸ’¡ æŒ‡çªç„¶é™ä¸´çš„å¥½è¿æ°”ï¼Œé€šå¸¸æ˜¯æ„æƒ³ä¸åˆ°çš„ç§¯æç»“æœã€‚</div>
            </div>
        </div>
        
        <!-- åŸæ–‡ä¾‹å¥éƒ¨åˆ†ï¼ˆå¯æŠ˜å +ç‹¬ç«‹æ»šåŠ¨ï¼‰ -->
        <div class="original-examples">
            <div class="original-header-row" onclick="toggleOriginalExamples(this)">
                <h2 class="original-header-title">åŸæ–‡ä¾‹å¥ï¼š</h2>
                <div class="stats-badge">
                    <span>1æœŸ</span>
                    <span class="stats-divider">|</span>
                    <span>ä¾‹å¥1</span>
                </div>
                <span class="original-expand-btn">â–¼</span>
            </div>
            
            <!-- ç‹¬ç«‹æ»šåŠ¨çš„å†…å®¹åŒºåŸŸ -->
            <div class="original-content">
                <div class="original-item">
                    <span class="episode-tag">EP5</span>
                    <div class="original-en english">And then <span class="highlight">the second</span> we get on Face Time or meet up, it's like no time has passed.</div>
                    <div class="original-cn chinese">ä½†æ¯æ¬¡ä¸€å¼€è§†é¢‘æˆ–è§é¢æ—¶ï¼Œæ„Ÿè§‰å°±åƒæ—¶é—´ä»æœªæµé€ã€‚</div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playOriginal('ep5-1')" title="æ’­æ”¾">â–·</button>
                        <button class="audio-btn" onclick="toggleRepeat(this, 'ep5-1')" title="å¾ªç¯æ’­æ”¾">âŸ²</button>
                        <span class="speed-input" 
                              onclick="enableSpeedEdit(this, 'ep5-1')"
                              title="ç‚¹å‡»ç¼–è¾‘é€Ÿåº¦">1x</span>
                    </div>
                </div>
                
                <div class="original-item">
                    <span class="episode-tag">EP13</span>
                    <div class="original-en english">It was pure <span class="highlight">serendipity</span> that we met at the coffee shop after so many years.</div>
                    <div class="original-cn chinese">æˆ‘ä»¬å¤šå¹´ååœ¨å’–å•¡åº—ç›¸é‡ï¼Œè¿™çº¯ç²¹æ˜¯ä¸€ç§æœºç¼˜å·§åˆã€‚</div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playOriginal('ep13-1')" title="æ’­æ”¾">â–·</button>
                        <button class="audio-btn" onclick="toggleRepeat(this, 'ep13-1')" title="å¾ªç¯æ’­æ”¾">âŸ²</button>
                        <span class="speed-input" 
                              onclick="enableSpeedEdit(this, 'ep13-1')"
                              title="ç‚¹å‡»ç¼–è¾‘é€Ÿåº¦">1x</span>
                    </div>
                </div>
                
                <div class="original-item">
                    <span class="episode-tag">EP13</span>
                    <div class="original-en english">The scientist's discovery was a result of <span class="highlight">serendipity</span> rather than careful planning.</div>
                    <div class="original-cn chinese">ç§‘å­¦å®¶çš„å‘ç°æ˜¯æœºç¼˜å·§åˆçš„ç»“æœï¼Œè€Œéç²¾å¿ƒç­–åˆ’ã€‚</div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playOriginal('ep13-2')" title="æ’­æ”¾">â–·</button>
                        <button class="audio-btn" onclick="toggleRepeat(this, 'ep13-2')" title="å¾ªç¯æ’­æ”¾">âŸ²</button>
                        <span class="speed-input" 
                              onclick="enableSpeedEdit(this, 'ep13-2')"
                              title="ç‚¹å‡»ç¼–è¾‘é€Ÿåº¦">1x</span>
                    </div>
                </div>
                
                <div class="original-item">
                    <span class="episode-tag">EP20</span>
                    <div class="original-en english">Finding this apartment was complete <span class="highlight">serendipity</span> - it was exactly what we needed.</div>
                    <div class="original-cn chinese">æ‰¾åˆ°è¿™å¥—å…¬å¯“å®Œå…¨æ˜¯æœºç¼˜å·§åˆâ€”â€”æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚</div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playOriginal('1æœˆ18æ—¥')" title="æ’­æ”¾">â–·</button>
                        <button class="audio-btn" onclick="toggleRepeat(this, '1æœˆ18æ—¥')" title="å¾ªç¯æ’­æ”¾">âŸ²</button>
                        <span class="speed-input" 
                              onclick="enableSpeedEdit(this, '1æœˆ18æ—¥')"
                              title="ç‚¹å‡»ç¼–è¾‘é€Ÿåº¦">1x</span>
                    </div>
                </div>
                ```

                **ç„¶ååˆ›å»ºå¯¹åº”çš„éŸ³é¢‘æ–‡ä»¶ï¼š**
                ```
                videos/1æœˆ18æ—¥.mp3
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // æ”¶è—åŠŸèƒ½ï¼ˆä½¿ç”¨V4çš„ç®€å•é€»è¾‘ï¼‰
        // ============================================
        
        function toggleFavorite(btn) {
            const wordData = {
                word: document.getElementById('wordTitle').textContent.trim(),
                phonetic: document.getElementById('wordPhonetic').textContent.trim(),
                translation: document.getElementById('wordTranslation').textContent.trim(),
                favoriteTime: new Date().toISOString()
            };
            
            // åˆ‡æ¢activeç±»
            btn.classList.toggle('active');
            
            // è·å–localStorageä¸­çš„æ”¶è—
            let favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
            
            if (btn.classList.contains('active')) {
                // ====== æ·»åŠ æ”¶è— ======
                btn.textContent = 'â¤';
                favorites[wordData.word] = wordData;
                localStorage.setItem('favorites', JSON.stringify(favorites));
                console.log('âœ“ å·²æ”¶è—:', wordData.word);
            } else {
                // ====== å–æ¶ˆæ”¶è— ======
                btn.textContent = 'â™¡';
                delete favorites[wordData.word];
                localStorage.setItem('favorites', JSON.stringify(favorites));
                console.log('âœ“ å–æ¶ˆæ”¶è—:', wordData.word);
            }
            
            console.log('å½“å‰æ”¶è—æ€»æ•°:', Object.keys(favorites).length);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ”¶è—çŠ¶æ€
        window.addEventListener('DOMContentLoaded', function() {
            const word = document.getElementById('wordTitle').textContent.trim();
            const favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
            const btn = document.querySelector('.favorite-btn');
            
            if (favorites[word]) {
                btn.classList.add('active');
                btn.textContent = 'â¤';
                console.log('æ­¤å•è¯å·²æ”¶è—:', word);
            } else {
                console.log('æ­¤å•è¯æœªæ”¶è—:', word);
            }
            
            console.log('å½“å‰æ”¶è—æ€»æ•°:', Object.keys(favorites).length);
        });
        
        // ============================================
        // å•è¯å‘éŸ³
        // ============================================
        
        function playSound(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½');
            }
        }
        
        // ============================================
        // æŠ˜å åŠŸèƒ½
        // ============================================
        
        function toggleExample(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.expand-btn');
            content.classList.toggle('show');
            arrow.classList.toggle('expanded');
        }
        
        function toggleOriginalExamples(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.original-expand-btn');
            content.classList.toggle('show');
            arrow.classList.toggle('expanded');
        }
        
        // ============================================
        // è§†é¢‘/éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
        // ============================================
        
        const audioCache = {};
        const audioStates = {};
        
        function playOriginal(id) {
            if (!audioCache[id]) {
                audioCache[id] = new Audio(`./videos/${id}.mp3`);
                audioCache[id].addEventListener('error', function(e) {
                    console.error('éŸ³é¢‘åŠ è½½å¤±è´¥:', id);
                    alert('éŸ³é¢‘æ–‡ä»¶åŠ è½½å¤±è´¥\nè¯·ç¡®ä¿è§†é¢‘æ–‡ä»¶å­˜åœ¨ï¼š./videos/' + id + '.mp3');
                });
            }
            
            const audio = audioCache[id];
            if (audioStates[id]) {
                audio.loop = audioStates[id].repeat || false;
                audio.playbackRate = audioStates[id].speed || 1;
            }
            
            audio.currentTime = 0;
            audio.play().catch(function(error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
            });
        }
        
        // ============================================
        // å¾ªç¯æ’­æ”¾åŠŸèƒ½
        // ============================================
        
        function toggleRepeat(btn, id) {
            if (!audioStates[id]) {
                audioStates[id] = { repeat: false, speed: 1 };
            }
            
            audioStates[id].repeat = !audioStates[id].repeat;
            btn.classList.toggle('active');
            
            if (audioCache[id]) {
                audioCache[id].loop = audioStates[id].repeat;
            }
            
            console.log('å¾ªç¯æ’­æ”¾' + (audioStates[id].repeat ? 'å¼€å¯' : 'å…³é—­') + ':', id);
        }
        
        // ============================================
        // æ’­æ”¾é€Ÿåº¦å¯ç¼–è¾‘åŠŸèƒ½
        // ============================================
        
        function enableSpeedEdit(element, audioId) {
            if (element.getAttribute('contenteditable') === 'true') {
                return;
            }
            
            const originalValue = element.textContent;
            element.textContent = originalValue.replace('x', '');
            element.setAttribute('contenteditable', 'true');
            element.focus();
            
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(element);
            selection.removeAllRanges();
            selection.addRange(range);
            
            const handleEnter = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applySpeed(element, audioId);
                }
            };
            
            const handleBlur = function() {
                applySpeed(element, audioId);
            };
            
            element.addEventListener('keydown', handleEnter);
            element.addEventListener('blur', handleBlur);
            element._handleEnter = handleEnter;
            element._handleBlur = handleBlur;
        }
        
        function applySpeed(element, audioId) {
            if (element._handleEnter) {
                element.removeEventListener('keydown', element._handleEnter);
                element.removeEventListener('blur', element._handleBlur);
                delete element._handleEnter;
                delete element._handleBlur;
            }
            
            let speedText = element.textContent.trim().replace('x', '');
            let speed = parseFloat(speedText);
            
            if (isNaN(speed) || speed < 0.5 || speed > 2) {
                speed = Math.max(0.5, Math.min(2, speed || 1));
            }
            
            speed = Math.round(speed * 10) / 10;
            element.textContent = speed + 'x';
            
            if (!audioStates[audioId]) {
                audioStates[audioId] = { repeat: false, speed: 1 };
            }
            audioStates[audioId].speed = speed;
            
            if (audioCache[audioId]) {
                audioCache[audioId].playbackRate = speed;
            }
            
            element.setAttribute('contenteditable', 'false');
            element.blur();
            console.log('æ’­æ”¾é€Ÿåº¦è®¾ç½®ä¸º:', speed, 'for', audioId);
        }
    </script>
</body>
</html>
